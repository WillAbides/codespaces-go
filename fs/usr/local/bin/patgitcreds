#!/bin/bash
#/ patgitcreds configures git use a personal access token to access repos on github.com

set -e

if [ ! -f "$HOME/.git-credentials" ]; then
  if [ -z "$GITHUB_TOKEN" ]; then
    read -srp 'Enter PAT to clone private repos:  ' GITHUB_TOKEN
    echo ""
  fi
  echo "https://x:$GITHUB_TOKEN@github.com" > "$HOME/.git-credentials"
fi

codespaceshelper="$(git config --system --default missing --get credential.helper)"

if [[ "$codespaceshelper" != *"codespaces"* ]]; then
  exit
fi

git config --local credential.helper "$codespaceshelper"
git config --system --unset credential.helper
git config --global credential.helper store
